{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-0">Admin Dashboard</h2>
    <small class="text-muted">Overview of registrations</small>
  </div>
  <div>
    <a href="/admin/download" class="btn btn-outline-light btn-sm me-2" style="background:#0d6efd;color:#fff">Download Excel</a>
    <a href="/admin/logout" class="btn btn-secondary btn-sm">Logout</a>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-sm-6 col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Total Registrations</h6>
        <h3 class="card-title">{{ total }}</h3>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Interested in Webinars</h6>
        <h3 class="card-title">{{ webinar_interest_count }}</h3>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Blood Donation Interested</h6>
        <h3 class="card-title">{{ blood_donation_count }}</h3>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-md-3">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted">Unique Colleges</h6>
        <h3 class="card-title">{{ college_counts|length }}</h3>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Qualification Breakdown</h5>
        <canvas id="qualChart" height="220"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="card-title">Designation Breakdown</h5>
        <canvas id="desigChart" height="220"></canvas>
      </div>
    </div>
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Gender Distribution</h5>
        <canvas id="genderChart" height="150"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="card mt-4">
  <div class="card-body">
    <h5 class="card-title">Recent Registrations</h5>
    <div class="table-responsive">
      <table class="table table-hover table-sm">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>WhatsApp</th>
            <th>Qualification</th>
            <th>Designation</th>
            <th>Blood Group</th>
            <th>Webinar Date</th>
            <th>Registered At</th>
          </tr>
        </thead>
        <tbody>
          {% for r in regs|reverse %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ r['Name'] }}</td>
            <td>{{ r['Email'] }}</td>
            <td>{{ r['WhatsApp'] }}</td>
            <td>{{ r['Qualification'] }}</td>
            <td>{{ r['Designation'] }}</td>
            <td>{{ r['Blood Group'] }}</td>
            <td>{{ r['Webinar Date'] }}</td>
            <td>{{ r['Registered At'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // data from server (lists of [label, value])
  const qual = {{ qual_counts|tojson }};
  const desig = {{ desig_counts|tojson }};
  const gender = {{ gender_counts|tojson }};

  function labelsAndValues(pairs){
    return [pairs.map(p=>p[0]), pairs.map(p=>p[1])];
  }

  const [qLabels, qValues] = labelsAndValues(qual);
  const [dLabels, dValues] = labelsAndValues(desig);
  const [gLabels, gValues] = labelsAndValues(gender);

  const pal = [ '#0d6efd','#6610f2','#6f42c1','#d63384','#dc3545','#fd7e14','#ffc107','#198754','#20c997','#0dcaf0' ];

  new Chart(document.getElementById('qualChart'), {
    type: 'bar',
    data: { labels: qLabels, datasets: [{ label: 'Count', data: qValues, backgroundColor: pal.slice(0,qValues.length) }] },
    options: { responsive:true, maintainAspectRatio:false }
  });

  new Chart(document.getElementById('desigChart'), {
    type: 'bar',
    data: { labels: dLabels, datasets: [{ label: 'Count', data: dValues, backgroundColor: pal.slice(0,dValues.length) }] },
    options: { responsive:true, maintainAspectRatio:false }
  });

  new Chart(document.getElementById('genderChart'), {
    type: 'doughnut',
    data: { labels: gLabels, datasets: [{ data: gValues, backgroundColor: pal.slice(0,gValues.length) }] },
    options: { responsive:true, maintainAspectRatio:false }
  });
</script>
{% endblock %}
